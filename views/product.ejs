<%- include('partials/header') %>
  <link rel="stylesheet" href="/css/product.css">

  <main class="wrapper">
    <div class="product">
      <% if (product.images && product.images.length> 0) { %>
        <img src="<%= product.images[0] %>" alt="<%= product.title %>">
        <% } %>

          <form action="/api/cart" method="POST" id="product-form">
            <input type="hidden" name="userId" value="<%= user.id %>">
            <input type="hidden" name="productId" value="<%= product.id %>">

            <label for="quantity">Quantity:</label>
            <input type="number" id="quantity" name="quantity" value="1" min="1" onchange="updateTotal()">

            <p>Total Price: <span id="total-price">$<%= product.price %></span></p>

            <button type="submit">Add to Cart</button>
          </form>
    </div>

    <div class="product-details">
      <h2>
        <%= product.title %>
      </h2>
      <p>
        <%= product.description %>
      </p>
      <p>Price: $<%= product.price %>
      </p>
      <small>Category: <%= product.category %></small>
    </div>
  </main>

  <script>
    function updateTotal() {
      const quantity = document.getElementById('quantity').value;
      const price = <%= product.price %>; // Use server-side variable
      const total = (quantity * price);
      document.getElementById('total-price').innerText = '$' + total;
    }
  </script>

  <%- include('partials/footer') %>